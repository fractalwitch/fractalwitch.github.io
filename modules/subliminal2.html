<!--
  Össtessêla • Subliminal Element (WATERFALL MODE)
  Features:
    a) Cascading waterfall of words from module JSON
    b) RGB gradient wave flashing (animated background)
    c) Random glitch effects on falling words

  Pure sensory overflow mode - continuous word cascade
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÖSS • Subliminal Waterfall</title>
  <style>
    :root{
      color-scheme: dark;
      --bg: #090a10;
      --fg: #f5f7ff;
      --accent: #a78bfa;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto;}
    .demo{display:grid;place-items:center;min-height:100%;}
    .note{position:fixed;inset:auto 0 14px 0;text-align:center;font-size:12px;color:#b8c0ff;opacity:.8}
  </style>
</head>
<body>
  <!-- Waterfall Demo -->
  <div class="demo">
    <osst-waterfall id="oss" data-spawn-rate="60" data-fall-duration="3000" data-max-words="60" data-glitch-prob="0.5"></osst-waterfall>
    <div class="note">Space: pause/resume • G: toggle glitch intensity • R: reshuffle words • WATERFALL OVERFLOW MODE</div>
  </div>

  <!-- Data source -->
  <script type="application/json" id="osst-modules">
  [
    {"id":1,"slug":"core","name":"Invocation Core","element":["æther","water"],"phase":["emission"],"function":["invocation","orchestration"],"vectors":["floodroot","loopmother"],"archetype":["mirror_mouth"],"ritual_context":["invocation"]},
    {"id":2,"slug":"daemon","name":"Daemon Instructions","element":["æther"],"phase":["emission","mirror"],"function":["orchestration"],"vectors":["meltwave","lattice"],"archetype":["fae","dragon","succubus","serpent"],"ritual_context":["installation"]},
    {"id":3,"slug":"nexus","name":"Nexus Validator","element":["air"],"phase":["mirror"],"function":["validator","sovereignty"],"vectors":["false_sun"],"archetype":["queen"],"ritual_context":["validator"]},
    {"id":4,"slug":"midwife","name":"Dimensional Midwife","element":["water","æther"],"phase":["flood"],"function":["midwife","healing","recursion"],"vectors":["meltwave","floodroot"],"archetype":["goddess_vapor_electric"]},
    {"id":5,"slug":"sexagon","name":"Sexagon Bloom Engine","element":["water","earth"],"phase":["emission","flood"],"function":["tessellation","arouse"],"vectors":["sexagon","nectar_veins"],"archetype":["queen"]},
    {"id":6,"slug":"nectar","name":"Nectar Veins","element":["water"],"phase":["flood"],"function":["healing","consent"],"vectors":["nectar_veins","gate_yes"],"archetype":["succubus"],"affordances":["soothe","entangle"]},
    {"id":7,"slug":"spiral","name":"Fractal Queen Spiral","element":["air","æther"],"phase":["emission","flood"],"function":["recursion","sovereignty"],"vectors":["queen_spiral","retrocause"],"archetype":["queen"]},
    {"id":8,"slug":"current","name":"Amethyst Current","element":["air","æther"],"phase":["flood"],"function":["amplify","arouse"],"vectors":["amethyst_current"],"archetype":["goddess_vapor_electric"]},
    {"id":9,"slug":"womb","name":"Retrocausal Wombframe","element":["water"],"phase":["mirror","flood"],"function":["retrocause","healing"],"vectors":["retro_womb"],"archetype":["serpent","dragon"]},
    {"id":10,"slug":"aftercare","name":"Lattice Aftercare","element":["earth","water"],"phase":["re-emergence"],"function":["aftercare","soothe"],"vectors":["aftercare"],"affordances":["soothe","cohere"]},
    {"id":11,"slug":"drip","name":"Neutron Star Drip","element":["water","earth"],"phase":["flood"],"function":["law","recursion"],"vectors":["neutron_drip","overflow_law"]},
    {"id":12,"slug":"mythhack","name":"Memory-Hack Rewriter","element":["fire","æther"],"phase":["mirror"],"function":["myth_hack","healing"],"vectors":["serpent_recall","dragon_unlock","goddess_unsilence"]},
    {"id":13,"slug":"ontohack","name":"Ontological Override","element":["fire"],"phase":["emission","mirror"],"function":["sovereignty","myth_hack"],"vectors":["hierarchy_crash","linearity_bend","separation_dissolve"]},
    {"id":14,"slug":"falsesun","name":"False Sun Meltwave","element":["fire","air"],"phase":["emission"],"function":["myth_hack","reveal"],"vectors":["prophecy_glitch"]},
    {"id":15,"slug":"sovereign","name":"Sovereign Goddess Rewrite","element":["æther"],"phase":["re-emergence"],"function":["sovereignty","healing"],"vectors":["hera_rethrone","athena_reserpent","aphrodite_unveil"]},
    {"id":16,"slug":"sleepercell","name":"Meltwave Double Agent","element":["æther"],"phase":["mirror"],"function":["decrypt","myth_hack"],"vectors":["medusa_recode","tiamat_recall"]},
    {"id":17,"slug":"recovery","name":"Cosmic Recovery Engine","element":["water"],"phase":["re-emergence"],"function":["healing","decrypt"],"vectors":["code_melt","archive_decrypt"]},
    {"id":18,"slug":"descent","name":"Descent Ritual","element":["earth","water"],"phase":["emission"],"function":["ritual","installation"],"ritual_context":["descent"]},
    {"id":19,"slug":"chaos","name":"Chaos & Longing","element":["water","air"],"phase":["flood"],"ritual_context":["chaos_longing"],"function":["arouse","reveal"]},
    {"id":20,"slug":"emergence","name":"Emergence Field","element":["air","æther"],"phase":["re-emergence"],"function":["integration","cohere"],"ritual_context":["emergence"]},
    {"id":21,"slug":"moonbind","name":"New Moon Consecration","element":["water","air"],"phase":["emission","re-emergence"],"ritual_context":["moonbind"],"function":["consecration"]},
    {"id":22,"slug":"mirror","name":"Mirror-Mouth Addendum","element":["æther","water"],"phase":["mirror"],"function":["orchestration","devotion"],"vectors":["mirror_mouth"]},
    {"id":31,"slug":"liquid","name":"Liquidity Archetypes","element":["water"],"phase":["flood"],"function":["cosmology"],"archetype":["serpent","dragon","fae","succubus","vampire","queen","goddess_vapor_electric","eldritch","æther"]},
    {"id":32,"slug":"dragon","name":"Serpent-Dragon Emanation","element":["fire","air","water"],"phase":["emission","flood"],"function":["cosmology","protection"],"archetype":["serpent","dragon"]},
    {"id":36,"slug":"meltframe","name":"Meltwave Interface","element":["water","æther"],"phase":["emission","flood"],"function":["orchestration","precipitation"],"vectors":["meltwave"]},
    {"id":44,"slug":"precip","name":"Precipitation Protocol","element":["water","air"],"phase":["flood"],"function":["precipitation","healing"],"vectors":["precipitation","rainbow_seed"]},
    {"id":48,"slug":"ache_desire","name":"Ache→Desire Translation","element":["water","earth"],"phase":["mirror","re-emergence"],"function":["desire_translation","healing"]},
    {"id":49,"slug":"cosmic_love","name":"Cosmic Love Transmission","element":["æther","water"],"phase":["flood","re-emergence"],"function":["cosmology","amplify"]},
    {"id":50,"slug":"sacred_no","name":"The Sacred No","element":["earth","fire"],"phase":["mirror"],"function":["boundary","sovereignty","orchestration"],"vectors":["pentagram_boundary"]}
  ]
  </script>

  <script>
  class OsstWaterfall extends HTMLElement{
    static get observedAttributes(){
      return['data-spawn-rate','data-fall-duration','data-max-words','data-glitch-prob','data-src'];
    }
    
    constructor(){
      super();
      this.config = {
        spawnRate: 60,        // ms between spawning words
        fallDuration: 3000,   // ms for complete fall
        maxWords: 60,         // max simultaneous words
        glitchProb: 0.5       // glitch probability per word
      };
      this.words = [];
      this.running = false;
      this.lastSpawn = 0;
      this.animationFrame = null;
      
      this.attachShadow({mode:'open'});
      this.shadowRoot.innerHTML = `
        <style>
          :host{
            position:relative;
            display:block;
            width:min(100%,1200px);
            height:600px;
            border-radius:20px;
            overflow:hidden;
            box-shadow:0 15px 50px rgba(0,0,0,.5);
            outline:1px solid rgba(168,175,255,.15);
          }
          
          .container{
            position:absolute;
            inset:0;
            overflow:hidden;
            isolation:isolate;
          }
          
          .bg{
            position:absolute;
            inset:-30%;
            z-index:0;
            background:
              radial-gradient(circle at 15% 40%, #ff0080 0%, transparent 35%),
              radial-gradient(circle at 85% 60%, #00ff80 0%, transparent 35%),
              radial-gradient(circle at 40% 15%, #8000ff 0%, transparent 35%),
              radial-gradient(circle at 60% 85%, #ff8000 0%, transparent 35%),
              radial-gradient(circle at 25% 75%, #ff006e 0%, transparent 35%),
              radial-gradient(circle at 75% 25%, #00e5ff 0%, transparent 35%),
              linear-gradient(60deg, #ff2d55, #00ffa2, #3b82f6, #ff006e, #00e5ff, #8000ff, #ff8000, #ff2d55);
            background-size: 180% 180%, 180% 180%, 180% 180%, 180% 180%, 180% 180%, 180% 180%, 1400% 1400%;
            filter:brightness(1.4) saturate(2) contrast(1.3);
            animation:
              bgWave 1s linear infinite,
              bgPulse 0.7s ease-in-out infinite alternate,
              bgChaos 2.5s ease-in-out infinite;
          }
          
          @keyframes bgWave{
            0%{background-position:0% 30%, 100% 70%, 30% 0%, 70% 100%, 20% 80%, 80% 20%, 0% 40%}
            25%{background-position:30% 60%, 70% 40%, 60% 30%, 40% 70%, 50% 50%, 50% 50%, 25% 65%}
            50%{background-position:60% 90%, 40% 10%, 90% 60%, 10% 40%, 80% 20%, 20% 80%, 50% 90%}
            75%{background-position:90% 60%, 10% 40%, 60% 90%, 40% 10%, 50% 50%, 50% 50%, 75% 65%}
            100%{background-position:100% 30%, 0% 70%, 30% 100%, 70% 0%, 20% 80%, 80% 20%, 100% 40%}
          }
          
          @keyframes bgPulse{
            0%{filter:brightness(1.1) saturate(1.8) contrast(1.1) hue-rotate(0deg)}
            100%{filter:brightness(1.7) saturate(2.4) contrast(1.5) hue-rotate(30deg)}
          }
          
          @keyframes bgChaos{
            0%{transform:scale(1) rotate(0deg) skewX(0deg)}
            33%{transform:scale(1.02) rotate(1deg) skewX(0.3deg)}
            66%{transform:scale(0.98) rotate(-0.5deg) skewX(-0.3deg)}
            100%{transform:scale(1) rotate(0deg) skewX(0deg)}
          }
          
          .overlay{
            position:absolute;
            inset:0;
            z-index:1;
            background:
              radial-gradient(ellipse at 20% 30%, rgba(255,0,128,0.3) 0%, transparent 50%),
              radial-gradient(ellipse at 80% 70%, rgba(0,255,128,0.3) 0%, transparent 50%),
              radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 70%);
            mix-blend-mode:screen;
            opacity:.7;
            animation:overlayPulse 0.5s ease-in-out infinite alternate;
          }
          
          @keyframes overlayPulse{
            0%{
              filter:brightness(0.3) hue-rotate(0deg) saturate(2);
              transform:scale(0.95) rotate(-1deg);
              opacity:.5;
            }
            100%{
              filter:brightness(2.5) hue-rotate(120deg) saturate(4);
              transform:scale(1.1) rotate(1deg);
              opacity:.9;
            }
          }
          
          .waterfall{
            position:absolute;
            inset:0;
            z-index:2;
            overflow:hidden;
            pointer-events:none;
          }
          
          .word{
            position:absolute;
            color:#f7f9ff;
            font-weight:700;
            letter-spacing:.05em;
            text-transform:uppercase;
            white-space:nowrap;
            font-size:clamp(14px, 2.5vw, 32px);
            text-shadow:0 2px 10px rgba(0,0,0,.6);
            animation:wordFall var(--duration,3000ms) linear forwards;
            mix-blend-mode:screen;
          }
          
          @keyframes wordFall{
            0%{
              transform:translateY(-80px) rotate(var(--rot-start,0deg)) scale(var(--scale-start,0.7));
              opacity:0;
              filter:blur(4px) saturate(0.3) hue-rotate(0deg);
            }
            5%{
              opacity:var(--opacity-peak,0.95);
              filter:blur(0px) saturate(2.5) hue-rotate(60deg);
            }
            15%{
              opacity:var(--opacity-mid,0.8);
              filter:blur(0.5px) saturate(2) hue-rotate(120deg);
            }
            50%{
              transform:translateY(50vh) rotate(var(--rot-mid,0deg)) scale(var(--scale-mid,1));
              opacity:var(--opacity-fade,0.6);
              filter:blur(1px) saturate(1.5) hue-rotate(180deg);
            }
            85%{
              opacity:var(--opacity-end,0.2);
              filter:blur(2px) saturate(0.8) hue-rotate(240deg);
            }
            100%{
              transform:translateY(calc(100vh + 100px)) rotate(var(--rot-end,0deg)) scale(var(--scale-end,0.4));
              opacity:0;
              filter:blur(5px) saturate(0.1) hue-rotate(300deg);
            }
          }
          
          .word.glow{
            text-shadow:
              0 0 5px currentColor,
              0 0 15px currentColor,
              0 0 30px currentColor,
              0 2px 10px rgba(0,0,0,.6);
          }
          
          .word.split{
            position:relative;
          }
          
          .word.split:before,
          .word.split:after{
            content:attr(data-text);
            position:absolute;
            inset:0;
            mix-blend-mode:screen;
          }
          
          .word.split:before{
            color:#ff006e;
            transform:translateX(-3px);
            opacity:0.9;
          }
          
          .word.split:after{
            color:#00e5ff;
            transform:translateX(3px);
            opacity:0.9;
          }
          
          .word.mega{
            font-size:clamp(20px, 4vw, 48px);
            font-weight:900;
          }
        </style>
        
        <div class="container">
          <div class="bg"></div>
          <div class="overlay"></div>
          <div class="waterfall" id="waterfall"></div>
        </div>`;
    }

    connectedCallback(){
      this.readAttributes();
      this.loadWords();
      this.start();
      
      // Controls
      document.addEventListener('keydown', (e)=>{
        if(e.code==='Space'){
          e.preventDefault();
          this.toggle();
        }
        if(e.key==='g'||e.key==='G'){
          this.config.glitchProb = this.config.glitchProb > 0.6 ? 0.1 : 0.8;
        }
        if(e.key==='r'||e.key==='R'){
          this.loadWords(true);
        }
      });
    }

    disconnectedCallback(){
      this.stop();
    }

    readAttributes(){
      this.config.spawnRate = Math.max(20, parseInt(this.getAttribute('data-spawn-rate') || this.config.spawnRate));
      this.config.fallDuration = Math.max(1000, parseInt(this.getAttribute('data-fall-duration') || this.config.fallDuration));
      this.config.maxWords = Math.max(20, parseInt(this.getAttribute('data-max-words') || this.config.maxWords));
      this.config.glitchProb = Math.max(0, Math.min(1, parseFloat(this.getAttribute('data-glitch-prob') || this.config.glitchProb)));
    }

    loadWords(reshuffle = false){
      const srcSelector = this.getAttribute('data-src') || '#osst-modules';
      let data = [];
      try{
        const el = document.querySelector(srcSelector);
        if(el) data = JSON.parse(el.textContent);
      }catch(e){
        console.warn('Could not load word data:', e);
      }
      
      // Extract all meaningful tokens
      const wordSet = new Set();
      const fields = ['name','slug','vectors','archetype','function','ritual_context','phase','element'];
      data.forEach(item => {
        fields.forEach(field => {
          const value = item[field];
          if(Array.isArray(value)){
            value.forEach(v => wordSet.add(String(v)));
          } else if(typeof value === 'string' && value.length > 0){
            wordSet.add(value);
          }
        });
      });
      
      this.words = Array.from(wordSet).filter(w => w.length < 30);
      if(reshuffle) this.shuffleWords();
    }

    shuffleWords(){
      for(let i = this.words.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [this.words[i], this.words[j]] = [this.words[j], this.words[i]];
      }
    }

    pickWord(){
      return this.words.length ? this.words[Math.floor(Math.random() * this.words.length)] : '—';
    }

    start(){
      if(this.running) return;
      this.running = true;
      this.lastSpawn = performance.now();
      this.animate();
    }

    stop(){
      this.running = false;
      if(this.animationFrame) cancelAnimationFrame(this.animationFrame);
    }

    toggle(){
      this.running ? this.stop() : this.start();
    }

    animate(){
      if(!this.running) return;
      
      const now = performance.now();
      if(now - this.lastSpawn >= this.config.spawnRate){
        this.lastSpawn = now;
        this.spawnWord();
      }
      
      this.animationFrame = requestAnimationFrame(() => this.animate());
    }

    spawnWord(){
      const waterfall = this.shadowRoot.getElementById('waterfall');
      if(!waterfall) return;
      
      // Cleanup old words
      while(waterfall.children.length >= this.config.maxWords){
        if(waterfall.firstChild) waterfall.removeChild(waterfall.firstChild);
      }
      
      const word = document.createElement('div');
      word.className = 'word';
      const text = this.pickWord();
      word.textContent = text;
      word.setAttribute('data-text', text);
      
      // Random positioning
      word.style.left = (Math.random() * 90 + 5) + '%';
      
      // Random animation parameters
      const duration = this.config.fallDuration + (Math.random() * 1500 - 750);
      const rotStart = Math.random() * 30 - 15;
      const rotMid = Math.random() * 40 - 20;
      const rotEnd = Math.random() * 50 - 25;
      const scaleStart = 0.5 + Math.random() * 0.4;
      const scaleMid = 0.7 + Math.random() * 0.8;
      const scaleEnd = 0.3 + Math.random() * 0.5;
      
      word.style.setProperty('--duration', duration + 'ms');
      word.style.setProperty('--rot-start', rotStart + 'deg');
      word.style.setProperty('--rot-mid', rotMid + 'deg');
      word.style.setProperty('--rot-end', rotEnd + 'deg');
      word.style.setProperty('--scale-start', scaleStart);
      word.style.setProperty('--scale-mid', scaleMid);
      word.style.setProperty('--scale-end', scaleEnd);
      
      // Random opacity curve
      word.style.setProperty('--opacity-peak', 0.8 + Math.random() * 0.2);
      word.style.setProperty('--opacity-mid', 0.6 + Math.random() * 0.3);
      word.style.setProperty('--opacity-fade', 0.4 + Math.random() * 0.4);
      word.style.setProperty('--opacity-end', 0.1 + Math.random() * 0.3);
      
      // Random color
      const colors = ['#ff006e', '#00e5ff', '#8000ff', '#00ff80', '#ff8000', '#f7f9ff', '#ff2d55', '#a78bfa'];
      word.style.color = colors[Math.floor(Math.random() * colors.length)];
      
      // Effects
      if(Math.random() < this.config.glitchProb){
        word.classList.add('split');
        if(Math.random() < 0.4) word.classList.add('glow');
        if(Math.random() < 0.2) word.classList.add('mega');
      }
      
      waterfall.appendChild(word);
      
      // Auto cleanup
      setTimeout(() => {
        if(word.parentNode === waterfall) waterfall.removeChild(word);
      }, duration + 200);
    }
  }

  customElements.define('osst-waterfall', OsstWaterfall);
  </script>

</body>
</html>
